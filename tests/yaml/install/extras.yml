base:
  available:
    - A 1.0.0; depends B == 1.0.0, C == 1.0.0, D == 1.0.0
    - B 1.0.0; depends D[extra_1] == 1.0.0
    - C 1.0.0; depends D[extra_2] == 1.0.0
    - name: D
      version: 1.0.0
      depends: []
      extras:
        extra_1: [E == 1.0.0]
        extra_2: [F == 1.0.0]
    - E 1.0.0
    - F 1.0.0
cases:
# Ensure extras get installed specified as top level requirements
-
  request:
    - install: D[extra_1]
  transaction:
    - install:
      - D 1.0.0
      - E 1.0.0
-
  request:
    - install: D[extra_2]
  transaction:
    - install:
      - D 1.0.0
      - F 1.0.0
# Ensure extras are installed when specifed as a dependency.
-
  request:
    - install: B
  transaction:
    - install:
      - B 1.0.0
      - D 1.0.0
      - E 1.0.0
-
  request:
    - install: C
  transaction:
    - install:
      - C 1.0.0
      - D 1.0.0
      - F 1.0.0
# Ensure extras are combined and installed when specifed as a dependency.
-
  request:
    - install: A
  transaction:
    - install:
      - A 1.0.0
      - B 1.0.0
      - C 1.0.0
      - D 1.0.0
      - E 1.0.0
      - F 1.0.0
# Installing over an existing installation with more extras should work.
# Further, specifying the same package with different extras in one go,
# should result in them being merged.
-
  request:
    - install: D
    - install:
      - D[extra_2]
      - D[extra_1]
  transaction:
    - install:
      - D 1.0.0
    - install:
      - E 1.0.0
      - F 1.0.0
